# 2024美赛论文初稿

## Abstract

近期网球新星Alcarez击败超级大满贯选手Djokovic ，赢得2024年温网男单冠军成为了社会热点事件，比赛期间出现了多次反转，其精彩程度引人入胜，同时也引起了我们对网球赛程中 "momentum" 的思考。

针对问题一，我们对题目给出的数据集进行了数据处理和特征提取，进而建立了**momentum metric function**来普适化的量化球员momentum，同时建立了由六个参数确定的**performance evaluation function**来具体衡量各个得分特征，并由此计算出**期望胜率**并与真实数据得分点建立了映射关系，从而建立了**目标函数和约束条件**。通过**最速下降法构成的BP参数优化过程**计算出目标函数的理想最优值以及对应的六个最优参数，并用确定的函数形式精确的量化了球员在具体时刻的表现优秀程度，同时给出了可视化过程，并从不同角度进行了分析。

针对问题二，我们分析问题并将其转换为判定网球赛程**是否为马尔可夫链**的问题，并在问题一模型的基础上构建出了马尔可夫链形式的评价函数，通过类似的训练过程确定函数内部的参数，并得到马尔可夫链下的目标函数最优解，我们将两种模型以及真实数据进行**假设检验**，最终得出**网球赛程是非马尔可夫链过程**。

针对问题三，我们在前面建立模型的基础上建立了**差值差分模型**，寻求**momentum metric function**的近似曲线**极值点**，我们认为这些得分点是momentum**发生转换**的关键节点。同时我们将数据集中**剩余的因素**纳入考虑范围，并建立了**体力值模型**，针对球员个人数据重新训练模型，并根据统计分析方法获取极值点对应的最相关的**四个影响因素**。通过数据集和对应的影响因素，我们给出了应对不同赛程情况不同对手球员的一些**常用策略**，为赛前准备和赛内决策提供支持。

针对问题四，我们将建立的模型在不同数据集上进行了**迁移测试**，并建立了**适水平评价模型**来定量分析模型在不同数据集上的表现水平。对于表现不佳的数据集，我们根据实际情况对模型的考虑因素进行了调整和结构更改，并找出了一些类似数据集中不同的考虑因素，以提高模型的**泛化能力**。

## Establishment and Solution of Model for Problem 1

#### Content of the problem

Develop a model that captures the flow of play as points occur and apply it to one or more of the matches. Your model should identify which player is performing better at a given time in the match, as well as how much better they are performing. Provide a visualization based on your model to depict the match flow. Note: in tennis, the player serving has a much higher probability of winning the point/game. You may wish to factor this into your model in some way.

#### Analysis of the problem

The problem requires us to develop a model that dynamically captures the performance status of both players in each points of a tennis match and presents it in a quantitative form to show the performance status of the players. At the same time, we hope that this model is universally applicable to valuable tennis match scenarios. Therefore, we consider starting from the scoring points, based on which we explore and consider multiple factors, in order to establish a comprehensive mathematical model to quantify the performance of the players; on the other hand, for the optimal selection of some parameters in the model, we consider using the whole dataset given in the title to carry out training, and according to the results of the training to guide the calibration of the relevant parameters, which in fact forms a model tuning BP process.

#### Modeling

We believe that there exists a "momentum" of the athlete's own state, which reflects the athlete's ability to master the game, the degree of his or her own strength, and the ability to reverse an unfavorable situation in the course of the game. This likelihood is related to the influence of the events that the athlete is subject to, such as whether the point is scored or not, whether he/she has the right to serve or not, etc., and it has a significant positive correlation with his/her probability of scoring a point.

Furthermore, we build a winning performance model based on the conditions and flow of the matches, which determines whether a player is performing well or not based only on the score-dependent game state parameter $X$ (note that we do not take into account factors that are closely related to the player's own characteristics, such as stamina level, resistance to stress, etc., in order to ensure the universality of the model), which consists of the following parameters:

Right to serve: $x_r:\{1,0\}$, 1 means the right belongs to you, 0 means the right belongs to the opponent.

Points scored/missed: $N:\{1,0\}$, 1 indicates a point scored, 0 indicates a point scored by the opponent.

Number of consecutive points scored/missed: $x_1$, positive integer, indicates the number of consecutive points scored or missed.

Whether or not the serving team made an error: $x_2:\{0,1\}$, 0 means no serving error, 1 means serving error.

Whether it is a game point or not: $x_g:\{1,0\}$, 1 means it is a game point, 0 means it is not.

Whether it is a set point: $x_s:\{1,0\}$, 1 means it is a set point, 0 means it is not.

Whether it is a direct service point: $x_3:\{1,0\}$, 1 means it is a direct service point, 0 means it is not.

ariable $x$ above is time-dependent $x(t_n)$ and the state parameter $X(t_n)=(x_r,N,x_1,x_2,x_3,x_4,x_g,x_s)$

Define the momentum metric function $Q(t_n)=kQ(t_{n-1})+F(X(t_{n-1}))$, where$n={1,2,3···}，Q(t_1)=0$, $t_1$ denotes the time of the first scoring point, and the decay rate, $k\in(0,1)$, is is used to measure the extent to which varying time away from that score point affects the momentum of the next scoring point, and we believe that the closer the event is to that scoring point, the more it will play a role in influencing the momentum of the next scoring point.

At the same time we define the predicted win rate：
$$
P=\frac{Q_1(t_n)-Q_2(t_n)}{Q_1(t_n)+Q_2(t_n)}
$$
Representing the predicted win rate for that score point derived from the quantized momentum, we argue that the greater the difference in momentum between player one and player two when player one's momentum is higher than player two's at that score point, the greater the likelihood that player one should be victorious at that score point.

Under this definition, F denotes the upward tendency of the player's winning percentage at the n-1st score point due to various game performances, and is used by us to evaluate the player's performance. The performance evaluation function is defined as follows:
$$
F(X(t_{n-1}))=[(1-x_r)\frac{q}{1-q}+x_r]\delta(N,1)[1+k_1(x_1-1)-k_2x_rx_2+k_3(x_g+x_s)]\\
-k_4[\frac{q}{1-q}x_r+(1-x_r)]\delta(N,0)[1+k_1(x_1-1)+k_5x_2x_r+k_3(x_g+x_s)+k_6x_3]
$$
Among that we consider:

1. the right to serve gives the player a greater advantage, we counted the average winning percentage q of the serving side in the dataset, and used the reward coefficient $\frac{q}{1-q}$ to amplify the performance score when the receiving side wins and the performance deduction when the serving side loses, here $q\approx0.6731$;
2. when scoring $N=1$, $\delta(N,1)=1,\delta(N,0)=0$, only the first term of F is non-zero, at this time, if the other side serves the ball, you get the reward coefficient $\frac{q}{1-q}$, otherwise, you get 1, and the same when $N=0$. That is, the first term of F is the positive rating when winning the game, and the second term is the negative rating when losing the game;
3. The last part of the two terms of F determines the base value of the evaluation score, including the win/loss situation, consecutive points scored or lost, and the effect of errors on one's own serve. In addition, wins and losses at set and game points have a greater impact on the player than those in general;
4. the scoring factors are related to each other, which in order to incorporate the examination of the model, such as the situation of the ball possession and the situation of the stronghold can reflect whether it is a break point or not.

On this basis, we define the optimization objective as
$$
min\left(T=\frac{1}{N_{play}}\sum_{all}\sum_{t_n}\left(\frac{Q_1(t_n)-Q_2(t_n)}{Q_1(t_n)+Q_2(t_n)}-N(t_n)\right)^2\right)
$$

The optimization goal is to make the predicted wins as close as possible to the actual wins. We include every scoring point of all games in the dataset in the training dataset, and parameterize it to obtain a universal evaluation model.

#### Solving and Analysis

First we processed and extracted the dataset provided by the question using python code, divided it into thirty-one complete matches, and extracted the required factors from each match, such as the right to serve, the number of serves, and so on, which in turn were transformed into the factors required for the performance evaluation function, such as consecutive points scored or lost, whether it was a set point or not, and so on. In turn, we achieve a complete reproduction of the above model and construct a functional form of the optimization objective, which is determined by six parameters, and whose function return value we expect to be as small as possible.

Using the Gradient Descent Method, the parameters were iteratively adjusted by BP, and the above objective function value was finally optimized to 0.4992, which indicates that the momentum predicted win rate conforms to the actual situation to approximately 0.65.

At the same time, we obtain a near-optimal solution for all k-parameters in the F function: $\vec{k}=(56.46, -26.96, 195.48, -190.65, 28.36, 49.67)$. Taking the final match played by Carlos Alcaraz against Novak Djokovic as an example, we plotted images of the variation of momentum $Q_1(t_n)$ and $Q_2(t_n)$ for both:

![](/Users/guyue/知识模块/Mathematical_modeling/2024_美赛/解题数据/Figure_2.png)

As you can see from the graph (where player 1 is Djokovic and player 2 is Alcarez), when the match first started, Djokovic was firmly in control of the match and thus dominated most of the points in the first set, however, as the match progressed, the momentum of the two athletes began to change, which allowed Alcarez started to fight back in the second set and took a hard fought set in a tie-breaker. Thereafter, Djokovic began to gradually take control of the match and won the third set comfortably with a huge 5 game difference. Although Djokovic regained a set in the fourth set (which is reflected in a small peak in the blue line in the graph late in the match), the match ultimately tipped the scales in favor of Alcarez, which is a reflection of Alcarez's momentum.

At the same time, we visualized the difference between the momentum of the two athletes in the race:

![Figure_1](/Users/guyue/知识模块/Mathematical_modeling/2024_美赛/解题数据/Figure_1.png)

This image provides another, more intuitive perspective on the flow of the match, as we can easily find which player is performing better at a given moment in time, which is reflected in the plus and minus of the vertical axis, while the absolute value of the vertical axis value quantifies how well the player is performing. In addition, looking at the fluctuations of the curve, it is easy to see that some of the turning points of the curve reflect the tendency that players are trying to take the pace of the game into their own hands.

In addition, we plotted the image of the performance evaluation function $F(X(t_{n-1}))$ of the two players in the flow of the game, and at the same time, in order to better observe the trend of its value through the more violent fluctuations, we made a certain fit to the discrete sequence composed of the function value, in order to fully show its relative trend on the basis of filtering out the violent fluctuations, as shown in the figure:

![](/Users/guyue/知识模块/Mathematical_modeling/2024_美赛/解题数据/Figure_4.png)

![Figure_3](/Users/guyue/知识模块/Mathematical_modeling/2024_美赛/解题数据/Figure_3.png)

The curve formed by the values returned by the performance evaluation function can be seen in the graph, and its general trend and relative magnitude are similar to the course of the game analyzed earlier, but what can be observed in particular is that towards the end of the game, the value of Djokovic's performance evaluation begins to drop drastically, which is considered to be a sign that, on one hand, he has completely lost the control over the situation, and, on the other hand, it also reveals that there may be the influence of some other potential factors in the course of the process, and that's exactly what we will need to take into account later on.

All in all, these charts give us a visual representation of the flow of the game and the performances of both players, and provide different perspectives for us to cut through and get a fuller picture of the game.

## Establishment and Solution of Model for Problem 2

#### Content of the Problem

A tennis coach is skeptical that “momentum” plays any role in the match. Instead, he postulates that swings in play and runs of success by one player are random. Use your model/metric to assess this claim.

#### Analysis of the Problem

The tennis coach believes that swings during a match are random and do not depend on so-called potential energy. According to our definition, momentum is the accumulated effect of a series of past events and conditions on whether or not the current point is scored, and this effect is reflected in the swings of each point. In other words, the coach believes that the result of the occurrence of the current scoring point event depends only on the current playing conditions and has nothing to do with the relevant events of the previous scoring points, i.e., the playing conditions of a tennis match are considered to be a Markov chain process; whereas, if momentum is considered to be present in the course of the match, i.e., the process is a non-Markov chain process. Therefore, in order to determine whether the tennis match is a Markov chain or not, based on the model of the first question, we delete the non-Markovian term $Q(t_{n-1})$ from the model, transform the performance function into the current performance function, and after replacing the state parameter $X(t_n)$ with $X'(t_n)$, we carry out the same training to obtain a Markov chain model representing the data and compare it with the original model to arrive at the final result. Comparison is made to arrive at the final result.

#### Modeling

Define the state space $S=\{(0,0,0),(1,0,0),...\}$ , to denote the current scores (points, games, sets), and $Y(t_n)$ to denote the scores at the moment of $t_n$. That is, the Markov chain-based model is satisfied:
$$
P\{Y(t_n)=s(t_n)|Y(t_1)=s(t_1),Y(t_2)=s(t_2),...,Y(t_{n-1})=s(t_{n-1})\}
\\=P\{Y(t_n)=s(t_n)|Y(t_{n-1})=s(t_{n-1})\}
$$

$$
P\{Y(t_n)=s(t_n)\}=F_{unknown}(X'(t_n),Y(t_{n-1}))
$$

where $X'(t_n)=(N(t_{n-1}),x_1(t_{n-1}),x_3(t_{n-1}),x_r(t_n),x_g(t_n),x_s(t_n),x_2=0)$, denotes the current state in the Markov chain.

In order to maintain formal consistency between the two models and to facilitate subsequent comparisons between the two models, we have selected the main state parameters from the first-question model, but have adopted a different composition for the scoring point. We consider that the state of the current scoring point consists of two components, the scoring situation of the previous point (winner/consecutive number of points/serve direct), and the nature of the current scoring point as it would have been if the point had not been scored (set point/game point/right to serve).

Let $Q'(t_n)=F(X'(t_n))$, and replace the performance function in the first-question model with the current performance function, then the probability of winning can be expressed as (where a negative probability denotes the opponent's winning percentage):
$$
P\{Y(t_n)=s(t_n)=Y(t_{n-1})+(1,0,0)\}=\frac{F(X'_1(t_n))-F(X'_2(t_n))}{F(X'_1(t_n))+F(X'_2(t_n))}
$$
We can obtain an optimization objective similar in form to the first problem:
$$
min\left(T'=\frac{1}{N_{play}}\sum_{all}\sum_{t_n}\left(\frac{F(X'_1(t_n))-F(X'_2(t_n))}{F(X'_1(t_n))+F(X'_2(t_n))}-N(t_n)\right)^2\right)
$$
For the performance function $F(X'(t_n))$ of the trained Markov chain model, we compare the convergence value and convergence accuracy of its optimization objective with the results in the first question. In addition, we compare the accuracy of the two models in predicting the true sequence point by point, i.e., we take the result of any game from the data set as the true data, and its true win/loss result N as the data sequence, i.e., $N(t_n)$, and input the information of the scoring points point by point into the optimized Q-model and F-model, and output the predicted win/loss probability of the next scoring point according to the corresponding probability formula, and get a sequence of win/loss probability Sequence $Q\{P_{t_n}\}$ and $F\{P_{t_n}\}$, calculate and compare the size of the two respectively:
$$
\sum_{t_n}\left(q_n-N(t_n)\right)^2
\\\sum_{t_n}\left(f_n-N(t_n)\right)^2
$$
A comprehensive multi-dimensional comparison of the two models, combined with a comparison of the true values, can adequately determine whether the tennis schedule is a Markov chain or not.

#### Solving and Analysis

The BP parameter optimization process for this model is also carried out using the Gradient Descent Method, and the specific optimization process is the same as in Problem 1, with only the functional form being different. The objective is optimized to obtain the optimal $T'=$ 0.6371, and the optimal parameter$\vec{k}=(9.45402225e+01，2.00000000e+00，-9.71597002e+01 -6.76735214e-03，20.000e+00，20.000e+00)$

In the first question, the convergence value of the optimization objective is $T=0.4992$. It can be found that $T'$ is significantly larger than $T$ and $\frac{T'-T}{\delta T}>>1$ compared to the optimization result in the first question, thus the optimal prediction of the winning percentage of the in-the-moment performance model without the consideration of the antecedent tournament conditions is significantly inferior to the momentum-performance model with the consideration of the antecedent tournament conditions.

Thus, we are well-conditioned to believe that the match play condition of tennis is a non-Markov chain, i.e., there exists a momentum that affects the swings at each point in the match.

## Establishment and Solution of Model for Problem 3

#### The First Problem

Coaches would love to know if there are indicators that can help determine when the flow of play is about to change from favoring one player to the other. 

Using the data provided for at least one match, develop a model that predicts these swings in the match. What factors seem most related (if any)?

#### The Second Problems

Given the differential in past match “momentum” swings how do you advise a player going into a new match against a different player?

#### Analysis of the problems

For the first question, we believe that for a given match data, the momentum metric function we built can give the full momentum change process of the match flow. Based on this, we believe that the key swings in the match where relative momentum shifts occur are often the swings in which the players start to change the current unfavorable situation after accumulating momentum and regain the initiative of the match. To predict these swings in the match, we can build a difference difference model on the basis of the momentum metric function to find the extreme points of the approximate relative momentum curve, and we believe that incredible swings tend to occur at these points.

For the points with incredible swings, we take the rest of the factors mentioned in the dataset into consideration in the model, including players' physical strength, hitting area, etc. (at the same time, we established a model of players' physical strength with respect to the time), and by means of statistical analysis, we get the four most relevant factors for each player in the points with incredible swings. pointss the four most relevant factors.

Thus, we can use past game data to understand a player's momentum trend and the factors most associated with momentum change. For the players themselves, we should consider how to make reasonable use of these factors for pre-match preparation, how to make reasonable use of the rules to make momentum change in the course of the match, and how to adjust their own rhythm for offense and defense conversion; on the other hand, when facing a new player, we can analyze the data to reasonably find out his weaknesses, so as to sabotage the opponents' advantageous situation, and reasonably allocate physical strength to the players. On the other hand, when facing a new player, we can analyze the data to find out his weaknesses, so as to destroy the opponent's advantage on the court, reasonably allocate the physical energy to consume the opponent, and positively utilize the right to serve to increase the scoring rate.

#### Modeing

First of all, we build a difference difference model $\Delta{Q}(i,\delta{q},j)$ based on momentum metric function, where i is the corresponding scoring point, $\delta{q}$ is the size of the chosen difference, and j is the corresponding player. Since each player is affected by different relevant influences, the training dataset of the model should be the player's own dataset and the rest of the information is additionally extracted as one of the datasets for the statistical analysis, so there is:
$$
\Delta{Q}(i,\delta{q},j)=R(F_{Data(j)})_{[p_1,p_2,p_3,p_4]}
$$
Where Data(j) is the corresponding dataset for player j, $p_1$ to $p_4$ are the four most relevant factors,R is the statistical analysis method used, specifically:
$$
R=max(\sum_{i=1}^{4}{p_i*F_i})
$$
Furthermore, we model the physical strength of the player with respect to time $H(i,t)$ and consider the factors that influence the physical strength, including：

Physical strength at the previous time $H(i,t-1)$.

The running distance h at this scoring point

The number of strokes at this point n

The stroke speed v at this time point

The rest time before this scoring point t

Combining the above factors there are:
$$
H(i,t)=H(i,t-1)-\phi_1h-\phi_2n-\phi_3v+\phi_4t
$$

#### Solving and Analysis

We take the data of the final match as an example for the difference difference score, and for the statistical analysis of the factors related to for the scoring points, we found that the four main influencing factors for Djokovic are [physical strength value, net points, serve rights, serve errors], while the four main factors for Alcarez are [consecutive points, serve rights, physical strength value, set points]. Combined with the previous analysis of the process of the final match, it is not difficult to find that Djokovic gradually lost the mastery of the game in the late stages of the match, and the performance point evaluation also declined rapidly, which may be related to the rapid decline of its physical strength value, while the net points are more important means of scoring, which can be seen that Djokovic has a more exquisite net skills; while Alcarez is less affected by the Alcarez, on the other hand, is less affected by the physical strength, so he can maintain a high level of competition, but it can be found that his scoring is more dependent on the right to serve, and it is more difficult to seize the initiative of the game in the set without the right to serve.

From the above examples, we can see that targeted training before the match and looking for the opponent's weaknesses, as well as actively adjusting the pace and using the rules of the game during the game can be more helpful to win the game, so we have summarized some common strategies for the game:

1. For the side affected by physical strength, the pace of the game should be appropriately accelerated, the game time should be shortened, and the physical strength should be actively utilized in the physical exhaustion of the rules to rest to obtain the recovery of physical strength.

2. For the opponent who is poor in a certain technical point, the data should be obtained from the data and targeted pre-match preparation.

3. For a team that is more dependent on the serve, it should give more stamina when it has the serve to improve its scoring.

4. For the team that is more affected by consecutive point losses, the rules should be used to break the trend of consecutive point losses.

5. For the team affected by service errors, reduce the amount of energy used when serving.

6. For players who are affected by physical strength, they may choose to give up some difficult balls to minimize the distance they have to run in order to maintain their physical strength.

7. For the opponent who is affected by the game point or match point game, he should pay more stamina value in these points.

The above strategies are partial strategies taken from the model, and actual matches should take into account fuller factors as well as more comprehensive strategies.

## Establishment and Solution of Model for Problem 4

#### Content of the Problem

Test the model you developed on one or more of the other matches. How well do you predict the swings in the match? If the model performs poorly at times, can you identify any factors that might need to be included in future models? How generalizable is your model to other matches (such as Women’s matches), tournaments, court surfaces, and other sports such as table tennis.

#### Analysis of the Problem

The problem examines the performance level of the model we built on the rest of the different types of datasets, and we should first build a pervasive level evaluation model to evaluate the performance level of the model. For the competition dataset where some of the factors are different but the basic kernel is similar, it is essentially migration learning to examine the migration ability of the model, and in the face of the fact that the results are not very good, we should be able to find out the factors that are more different between the two datasets, so as to make certain modifications to the key structure of the model to adapt it more to the specific situation, which is also a manifestation of the model's pervasive level.

#### Modeling

Considering the performance level of the model on different datasets, we build a universal level evaluation model $O(Data_i)$, which represents the performance level on the ith dataset, which is specified as:
$$
O(Data_i)=\frac{\sum_{t}^{all Data}\sqrt{|(F(t)-Data(t))|}}{\sum_{t}^{all}\sqrt{|Data(t)|}}
$$
For datasets with poor model performance, we should restructure the relevant factors according to the actual situation and retrain the F-function to make it more adaptable to datasets with specific characteristics.

#### Solving and Analysis

We searched for different datasets and tested the models for different datasets with the universal level evaluation model, and found that it performed well on datasets such as Men's Singles Championships, Red Clay Courts, etc., while it did not perform well on datasets such as Women's Singles Grand Slam, Hard Courts, Table Tennis, etc., which suggests that the latter should be taken into account with different factors and focuses, e.g., in Women's Singles matches, serve advantage in women's singles matches, the greater relationship between stroke speed and points scored or lost in Hard Courts, the greater emphasis on individual skill in table tennis matches and the lesser importance of fitness values, and so on.

In summary, our model generalizes better on datasets with more similar features, while on datasets that are not similar, elements such as the function structure should be changed according to the actual situation.
